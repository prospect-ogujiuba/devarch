---
phase: 02-stack-crud
plan: 05
type: execute
wave: 3
depends_on: ["02-02", "02-03"]
files_modified:
  - dashboard/src/routes/stacks/$name.tsx
  - dashboard/src/components/stacks/create-stack-dialog.tsx
  - dashboard/src/components/stacks/edit-stack-dialog.tsx
  - dashboard/src/components/stacks/delete-stack-dialog.tsx
  - dashboard/src/components/stacks/clone-stack-dialog.tsx
  - dashboard/src/components/stacks/rename-stack-dialog.tsx
  - dashboard/src/components/stacks/disable-stack-dialog.tsx
autonomous: false

must_haves:
  truths:
    - "Stack detail page shows all metadata, instances, network info"
    - "Create dialog validates name with prescriptive errors"
    - "Delete dialog shows cascade preview (blast radius)"
    - "Disable dialog enumerates affected containers by name"
    - "Clone creates records only, no containers started"
    - "Rename feels first-class (clone + soft-delete behind scenes)"
    - "All dialogs accessible from detail header and list context menu"
  artifacts:
    - path: "dashboard/src/routes/stacks/$name.tsx"
      provides: "Stack detail page"
      contains: "useStack"
    - path: "dashboard/src/components/stacks/create-stack-dialog.tsx"
      provides: "Create stack dialog with name validation"
      contains: "CreateStackDialog"
    - path: "dashboard/src/components/stacks/delete-stack-dialog.tsx"
      provides: "Delete confirmation with cascade preview"
      contains: "DeleteStackDialog"
  key_links:
    - from: "dashboard/src/routes/stacks/$name.tsx"
      to: "dashboard/src/features/stacks/queries.ts"
      via: "useStack hook"
      pattern: "useStack"
---

<objective>
Build stack detail page and all action dialogs (create, edit, delete, clone, rename, disable).

Purpose: Full stack management UI — users can perform all stack operations from dashboard.
Output: Detail page + 6 dialog components.
</objective>

<execution_context>
@/home/fhcadmin/.claude/get-shit-done/workflows/execute-plan.md
@/home/fhcadmin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/02-stack-crud/02-CONTEXT.md
@.planning/phases/02-stack-crud/02-02-SUMMARY.md
@.planning/phases/02-stack-crud/02-03-SUMMARY.md
@dashboard/src/routes/services/$name.tsx
@dashboard/src/components/ui/dialog.tsx
@dashboard/src/components/ui/confirm-dialog.tsx
@dashboard/src/components/ui/alert-dialog.tsx
@dashboard/src/types/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create all stack action dialogs</name>
  <files>
    dashboard/src/components/stacks/create-stack-dialog.tsx
    dashboard/src/components/stacks/edit-stack-dialog.tsx
    dashboard/src/components/stacks/delete-stack-dialog.tsx
    dashboard/src/components/stacks/clone-stack-dialog.tsx
    dashboard/src/components/stacks/rename-stack-dialog.tsx
    dashboard/src/components/stacks/disable-stack-dialog.tsx
  </files>
  <action>
Use existing Dialog/AlertDialog Radix components. Each dialog uses corresponding mutation hook from queries.ts.

**CreateStackDialog:** Form with name (input) + description (textarea). Name validated on blur — show inline prescriptive error if invalid. On submit: useCreateStack mutation. On success: close dialog, navigate to new stack. Props: `open, onOpenChange`.

**EditStackDialog:** Pre-filled description textarea (name shown but not editable). useUpdateStack mutation. Props: `stack, open, onOpenChange`.

**DeleteStackDialog:** Uses useDeletePreview to fetch cascade summary. Shows: "This will soft-delete stack 'X' and stop N containers: [container1, container2, ...]". Confirm button. useDeleteStack mutation. Props: `stack, open, onOpenChange`.

**CloneStackDialog:** Input for new name. Shows source stack name. useCloneStack mutation. Props: `stack, open, onOpenChange`.

**RenameStackDialog:** Input for new name (pre-filled with current). Explains: rename creates a copy with new name and archives the old one. useRenameStack mutation. Props: `stack, open, onOpenChange`.

**DisableStackDialog:** Shows confirmation with affected containers listed by name (from stack.instances). "N containers will be stopped: [names]". useDisableStack mutation. Props: `stack, open, onOpenChange`.

All dialogs: loading state on submit button, error display from mutation, close on success.
  </action>
  <verify>`cd /home/fhcadmin/projects/devarch/dashboard && npx tsc --noEmit --skipLibCheck 2>&1 | head -20`</verify>
  <done>All 6 dialog components created with proper mutations, validation, and cascade previews.</done>
</task>

<task type="auto">
  <name>Task 2: Create stack detail page</name>
  <files>dashboard/src/routes/stacks/$name.tsx</files>
  <action>
TanStack Router file route: `createFileRoute('/stacks/$name')`. Use `useStack(name)` query.

**Layout:**
- Header: Stack name (h1), enabled badge, description
- Header actions: Enable/Disable button, Clone, Rename, Delete (dropdown menu for less common actions)
- All actions trigger corresponding dialogs

**Sections:**
1. **Overview cards:** Status (enabled/disabled), Instance Count, Running Count, Created date, Last Updated
2. **Instances table:** List service_instances with columns: Instance ID, Template Service, Container Name, Status. Empty state if no instances: "No instances yet — add services in Phase 3"
3. **Network info:** Network name (or "Not configured" if null). Placeholder for Phase 4.

**Loading:** Loader2 spinner while loading. 404 handling if stack not found.

Import and render all dialog components. Manage open state for each dialog.

Wire the create dialog into the list page too — export CreateStackDialog and import in stacks/index.tsx (add a "Create Stack" button in the toolbar that opens the dialog).
  </action>
  <verify>`cd /home/fhcadmin/projects/devarch/dashboard && npx tsc --noEmit --skipLibCheck 2>&1 | head -20`. Route file exists at correct path.</verify>
  <done>Stack detail page shows full metadata, instances, network info. All actions available via header buttons/menu. Dialogs wired correctly.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete stack CRUD dashboard: list page (grid+table), detail page, create/edit/delete/clone/rename/disable dialogs</what-built>
  <how-to-verify>
    1. Start dashboard: `cd dashboard && npm run dev`
    2. Navigate to /stacks — verify empty state with "Create your first stack" CTA
    3. Click create — fill name "my-laravel", description "Laravel dev stack" — submit
    4. Verify stack appears in list (both grid and table view — toggle)
    5. Click stack to view detail page — verify metadata displayed
    6. Test edit (change description), clone, rename, disable, enable, delete
    7. Verify delete shows cascade preview before confirming
    8. Verify disabled confirmation shows container names
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
- All dialog components exist in dashboard/src/components/stacks/
- Detail route exists at dashboard/src/routes/stacks/$name.tsx
- `npm run build:strict` passes (or only pre-existing errors)
- All mutations wired to correct API endpoints
</verification>

<success_criteria>
Stack detail page shows all stack info. All 6 dialogs work with proper validation, cascade previews, and mutation feedback. Actions accessible from both list and detail views.
</success_criteria>

<output>
After completion, create `.planning/phases/02-stack-crud/02-05-SUMMARY.md`
</output>
