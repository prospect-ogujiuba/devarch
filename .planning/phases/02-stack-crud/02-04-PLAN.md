---
phase: 02-stack-crud
plan: 04
type: execute
wave: 3
depends_on: ["02-03"]
files_modified:
  - dashboard/src/routes/stacks/index.tsx
  - dashboard/src/components/stacks/stack-grid.tsx
  - dashboard/src/components/stacks/stack-table.tsx
autonomous: true

must_haves:
  truths:
    - "Stack list page shows card grid and table view with toggle"
    - "Search, sort, filter persist when toggling views"
    - "Empty state shows CTA to create first stack"
    - "Cards show name, description, status counts, enabled state, quick actions"
    - "Table rows are clickable (navigate to detail) with action buttons"
  artifacts:
    - path: "dashboard/src/routes/stacks/index.tsx"
      provides: "Stack list page with dual view"
      contains: "useStacks"
    - path: "dashboard/src/components/stacks/stack-grid.tsx"
      provides: "Card grid view for stacks"
      contains: "StackGrid"
    - path: "dashboard/src/components/stacks/stack-table.tsx"
      provides: "Table view for stacks"
      contains: "StackTable"
  key_links:
    - from: "dashboard/src/routes/stacks/index.tsx"
      to: "dashboard/src/features/stacks/queries.ts"
      via: "useStacks hook"
      pattern: "useStacks"
    - from: "dashboard/src/routes/stacks/index.tsx"
      to: "dashboard/src/hooks/use-list-controls.ts"
      via: "useListControls hook"
      pattern: "useListControls"
---

<objective>
Build stack list page with card grid + table view toggle, search, sort, filter, and empty state.

Purpose: Primary entry point for stack management — users see all stacks at a glance.
Output: /stacks route with dual-view list, toolbar, empty state.
</objective>

<execution_context>
@/home/fhcadmin/.claude/get-shit-done/workflows/execute-plan.md
@/home/fhcadmin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/02-stack-crud/02-CONTEXT.md
@.planning/phases/02-stack-crud/02-03-SUMMARY.md
@dashboard/src/routes/services/index.tsx
@dashboard/src/components/services/service-grid.tsx
@dashboard/src/components/services/service-table.tsx
@dashboard/src/hooks/use-list-controls.ts
@dashboard/src/components/ui/empty-state.tsx
@dashboard/src/components/ui/list-toolbar.tsx
@dashboard/src/types/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StackGrid and StackTable components</name>
  <files>dashboard/src/components/stacks/stack-grid.tsx, dashboard/src/components/stacks/stack-table.tsx</files>
  <action>
Follow service-grid.tsx and service-table.tsx patterns.

**StackGrid:** Card layout using existing Card component.
- Each card shows: name (bold), description (truncated), enabled badge, instance count, running count as "N/M running" with color coding (green if all running, yellow if partial, gray if none)
- Quick action buttons: enable/disable toggle, delete (icon buttons in card footer)
- Cards are clickable (Link to /stacks/$name)
- Props: `stacks: Stack[], onEnable, onDisable, onDelete`

**StackTable:** Using existing Table component.
- Columns: Name, Description, Status (enabled/disabled badge), Instances (count), Running, Created, Actions
- Rows clickable (navigate to /stacks/$name via Link)
- Action column: dropdown menu with Enable/Disable, Clone, Rename, Delete
- Props: same as grid

Both components receive filtered/sorted stacks from parent (useListControls handles filtering).
  </action>
  <verify>`cd /home/fhcadmin/projects/devarch/dashboard && npx tsc --noEmit --skipLibCheck 2>&1 | head -20`</verify>
  <done>StackGrid and StackTable components render stack data with actions. Both support click-to-navigate.</done>
</task>

<task type="auto">
  <name>Task 2: Create stacks list route page</name>
  <files>dashboard/src/routes/stacks/index.tsx</files>
  <action>
Follow services/index.tsx pattern exactly:

1. Create TanStack Router file route: `createFileRoute('/stacks/')`
2. Use `useStacks()` query hook for data
3. Use `useListControls` with:
   - storageKey: 'stacks'
   - searchFn: search by name and description
   - sortFns: name (localeCompare), status (enabled), instances (count), created (date)
   - filterFns: status filter (enabled/disabled/all)
   - defaultView: 'grid'
4. Render ListToolbar with search, sort, view toggle, and "Create Stack" button (Link or triggers modal — use dialog approach for create)
5. Conditional render: StackGrid or StackTable based on viewMode
6. EmptyState when no stacks exist: icon=Layers, title="No stacks yet", description="Stacks let you group related services into isolated environments", action button="Create your first stack"
7. Loading state with Loader2 spinner (same as services page)
8. StatCards row at top: Total Stacks, Enabled, Disabled, Total Instances

Wire mutations for quick actions: useDeleteStack, useEnableStack, useDisableStack passed to grid/table components.
  </action>
  <verify>`cd /home/fhcadmin/projects/devarch/dashboard && npx tsc --noEmit --skipLibCheck 2>&1 | head -20`. Check route file exists.</verify>
  <done>Stacks list page renders with dual view toggle, search, sort, filter, empty state, stat cards, and quick actions.</done>
</task>

</tasks>

<verification>
- `cd /home/fhcadmin/projects/devarch/dashboard && npx tsc --noEmit --skipLibCheck` passes
- Stack list route exists at dashboard/src/routes/stacks/index.tsx
- Grid and table components exist in dashboard/src/components/stacks/
- Empty state renders when no stacks
- useListControls provides shared state between views
</verification>

<success_criteria>
Stack list page accessible at /stacks. Card grid and table views toggle seamlessly. Search/sort/filter shared across views. Empty state with CTA shown when no stacks. Quick actions work.
</success_criteria>

<output>
After completion, create `.planning/phases/02-stack-crud/02-04-SUMMARY.md`
</output>
