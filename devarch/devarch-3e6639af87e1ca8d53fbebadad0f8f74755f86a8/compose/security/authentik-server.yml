networks:
  microservices-net:
    external: true

volumes:
  authentik_media:
  authentik_certs:
  authentik_templates:

services:
  authentik-server:
    container_name: authentik-server
    image: ghcr.io/goauthentik/server:latest
    restart: unless-stopped
    env_file: ../../.env
    environment:
      - AUTHENTIK_SECRET_KEY=${AUTHENTIK_SECRET_KEY:-change-me-please-use-random-string}
      - AUTHENTIK_POSTGRESQL__HOST=postgres
      - AUTHENTIK_POSTGRESQL__USER=postgres
      - AUTHENTIK_POSTGRESQL__NAME=authentik
      - AUTHENTIK_POSTGRESQL__PASSWORD=admin1234567
      - AUTHENTIK_REDIS__HOST=redis
      - AUTHENTIK_ERROR_REPORTING__ENABLED=false
      - AUTHENTIK_LOG_LEVEL=${AUTHENTIK_LOG_LEVEL:-info}
    command: server
    ports:
      - "127.0.0.1:9720:9000"
      - "127.0.0.1:9721:9443"
    volumes:
      - authentik_media:/media
      - authentik_certs:/certs
      - authentik_templates:/templates
    networks:
      - microservices-net
    depends_on:
      - postgres
      - redis
