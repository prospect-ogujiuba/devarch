# # config/nginx/dev-projects.conf
# # Development Projects Auto-Routing Configuration
# # This file handles automatic routing for *.dev.test domains

# # Main development projects server block
# server {
#     listen 80;
#     listen [::]:80;
    
#     # Match any subdomain ending with .dev.test
#     server_name ~^(?<project>[a-zA-Z0-9-]+)\.dev\.test$;
    
#     # Set document root based on project name
#     root /var/www/html/$project/public;
#     index index.html index.htm index.php;
    
#     # Add security headers
#     add_header X-Frame-Options "SAMEORIGIN" always;
#     add_header X-XSS-Protection "1; mode=block" always;
#     add_header X-Content-Type-Options "nosniff" always;
#     add_header X-Forwarded-Proto $scheme always;
    
#     # Main location block
#     location / {
#         # Try files, then directory, then 404 or project not found
#         try_files $uri $uri/ @project_not_found;
#     }
    
#     # Handle PHP files
#     location ~ \.php$ {
#         try_files $uri =404;
#         fastcgi_split_path_info ^(.+\.php)(/.+)$;
#         fastcgi_pass php:9000;  # PHP container service name
#         fastcgi_index index.php;
#         include fastcgi_params;
#         fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#         fastcgi_param PATH_INFO $fastcgi_path_info;
#         fastcgi_param PROJECT_NAME $project;
#         fastcgi_param SERVER_NAME $server_name;
#         fastcgi_param HTTP_HOST $http_host;
#     }
    
#     # Handle static assets with caching
#     location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp|avif)$ {
#         expires 1y;
#         add_header Cache-Control "public, immutable";
#         try_files $uri =404;
#     }
    
#     # Handle Node.js applications (if running on different ports)
#     location ~ ^/(api|socket\.io)/ {
#         # Check if there's a Node.js app running for this project
#         proxy_pass http://node:3000;
#         proxy_http_version 1.1;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection "upgrade";
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#         proxy_set_header X-Project-Name $project;
#     }
    
#     # Project not found handler
#     location @project_not_found {
#         return 302 https://projects.dev.test/;
#     }
    
#     # Deny access to sensitive files
#     location ~ /\. {
#         deny all;
#     }
    
#     location ~ /(\.htaccess|\.htpasswd|\.env|composer\.json|composer\.lock|package\.json|yarn\.lock) {
#         deny all;
#     }
    
#     # Optimize common files
#     location = /favicon.ico {
#         access_log off;
#         log_not_found off;
#         expires 1y;
#     }
    
#     location = /robots.txt {
#         access_log off;
#         log_not_found off;
#         expires 1y;
#     }
    
#     # Logging per project
#     error_log /var/log/nginx/$project-dev.error.log;
#     access_log /var/log/nginx/$project-dev.access.log;
# }

# # Projects listing/dashboard server
# server {
#     listen 80;
#     server_name projects.dev.test;
#     root /var/www/html;
    
#     # Custom project listing page
#     location / {
#         # Try for a custom index, otherwise auto-generate listing
#         try_files /projects-index.html @autoindex;
#     }
    
#     location @autoindex {
#         autoindex on;
#         autoindex_exact_size off;
#         autoindex_localtime on;
#         autoindex_format html;
#     }
    
#     # Style the autoindex page
#     location = /autoindex.css {
#         add_header Content-Type text/css;
#         return 200 "
#         body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
#         h1 { color: #333; border-bottom: 2px solid #007acc; padding-bottom: 10px; }
#         a { color: #007acc; text-decoration: none; display: block; padding: 8px 0; }
#         a:hover { background: #e6f3ff; padding-left: 10px; }
#         pre { background: white; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
#         ";
#     }
    
#     error_log /var/log/nginx/projects-dev.error.log;
#     access_log /var/log/nginx/projects-dev.access.log;
# }
